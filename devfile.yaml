schemaVersion: 2.2.0
metadata:
  name: developer-workspace
components:
  - name: nginx
    container:
      image: nginx:alpine
      memoryLimit: 512Mi
      endpoints:
        - name: gateway
          targetPort: 8080
          exposure: public
      volumeMounts:
        - name: nginx-conf
          path: /etc/nginx

  - name: service-a
    container:
      image: maven:3.8-openjdk-17
      memoryLimit: 1Gi
      command: [ "mvn", "spring-boot:run" ]
      workingDir: /spring-microservices-openshift/service-a
      mountSources: true

  - name: service-b
    container:
      image: maven:3.8-openjdk-17
      memoryLimit: 1Gi
      command: [ "mvn", "spring-boot:run", "-Dspring-boot.run.arguments=--server.port=8082" ]
      workingDir: /spring-microservices-openshift/service-b
      mountSources: true

  - name: service-c
    container:
      image: maven:3.8-openjdk-17
      memoryLimit: 1Gi
      command: [ "mvn", "spring-boot:run", "-Dspring-boot.run.arguments=--server.port=8083" ]
      workingDir: /spring-microservices-openshift/service-c
      mountSources: true

  - name: service-d
    container:
      image: maven:3.8-openjdk-17
      memoryLimit: 1Gi
      command: [ "mvn", "spring-boot:run", "-Dspring-boot.run.arguments=--server.port=8084" ]
      workingDir: /spring-microservices-openshift/service-d
      mountSources: true

commands:
  - id: reload-nginx
    exec:
      component: nginx
      commandLine: |
        cp /projects/gateway/nginx.conf /etc/nginx/nginx.conf && nginx -s reload
      group:
        kind: build
        isDefault: true
